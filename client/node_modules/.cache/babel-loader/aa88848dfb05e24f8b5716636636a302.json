{"ast":null,"code":"var _jsxFileName = \"/Users/seojin-won/wisdom-x-wisdom/client/src/containers/CommunicationContainer.js\";\nimport React from 'react';\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer';\nimport Communication from '../components/Communication';\nimport store from '../store';\nimport { connect } from 'react-redux';\nimport { getDisplayStream } from './media-access';\n\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      localStream: {},\n      remoteStreamUrl: '',\n      streamUrl: '',\n      initiator: false,\n      peer: {},\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n  }\n\n  hideAuth() {\n    this.props.media.setState({\n      bridge: 'connecting'\n    });\n  }\n\n  full() {\n    this.props.media.setState({\n      bridge: 'full'\n    });\n  }\n\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props);\n    this.setState({\n      video: this.props.video,\n      audio: this.props.audio\n    });\n    socket.on('create', () => this.props.media.setState({\n      user: 'host',\n      bridge: 'create'\n    }));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () => this.props.media.setState({\n      user: 'guest',\n      bridge: 'join'\n    }));\n    socket.on('approve', ({\n      message,\n      sid\n    }) => {\n      this.props.media.setState({\n        bridge: 'approve'\n      });\n      this.setState({\n        message,\n        sid\n      });\n    });\n    socket.emit('find');\n    this.props.getUserMedia.then(stream => {\n      this.localStream = stream;\n      this.localStream.getVideoTracks()[0].enabled = this.state.video;\n      this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n    });\n  }\n\n  handleInput(e) {\n    this.setState({\n      [e.target.dataset.ref]: e.target.value\n    });\n  }\n\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n\n  toggleVideo() {\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({\n      video: video\n    });\n    this.props.setVideo(video);\n  }\n\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({\n      audio: audio\n    });\n    this.props.setAudio(audio);\n  }\n\n  handleHangup() {\n    this.props.media.hangup();\n  }\n\n  getDisplay() {\n    getDisplayStream().then(stream => {\n      stream.oninactive = () => {\n        this.state.peer.removeStream(this.state.localStream);\n        this.getUserMedia().then(() => {\n          this.state.peer.addStream(this.state.localStream);\n        });\n      };\n\n      this.setState({\n        streamUrl: stream,\n        localStream: stream\n      });\n      this.localVideo.srcObject = stream;\n      this.state.peer.addStream(stream);\n    });\n  }\n\n  render() {\n    return React.createElement(Communication, Object.assign({}, this.state, {\n      toggleVideo: this.toggleVideo,\n      toggleAudio: this.toggleAudio,\n      send: this.send,\n      handleHangup: this.handleHangup,\n      handleInput: this.handleInput,\n      handleInvitation: this.handleInvitation,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = store => ({\n  video: store.video,\n  audio: store.audio\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setVideo: boo => store.dispatch({\n    type: 'SET_VIDEO',\n    video: boo\n  }),\n  setAudio: boo => store.dispatch({\n    type: 'SET_AUDIO',\n    audio: boo\n  })\n});\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);","map":{"version":3,"sources":["/Users/seojin-won/wisdom-x-wisdom/client/src/containers/CommunicationContainer.js"],"names":["React","PropTypes","MediaContainer","Communication","store","connect","getDisplayStream","CommunicationContainer","Component","constructor","props","state","localStream","remoteStreamUrl","streamUrl","initiator","peer","sid","message","audio","video","handleInvitation","bind","handleHangup","handleInput","toggleVideo","toggleAudio","send","hideAuth","media","setState","bridge","full","componentDidMount","socket","console","log","on","user","role","init","emit","getUserMedia","then","stream","getVideoTracks","enabled","getAudioTracks","e","target","dataset","ref","value","preventDefault","setVideo","setAudio","hangup","getDisplay","oninactive","removeStream","addStream","localVideo","srcObject","render","mapStateToProps","mapDispatchToProps","dispatch","boo","type","propTypes","object","isRequired","bool","func","instanceOf"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer'\nimport Communication from '../components/Communication'\nimport store from '../store'\nimport { connect } from 'react-redux'\nimport {getDisplayStream} from './media-access'\n\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      localStream: {},\n      remoteStreamUrl: '',\n      streamUrl: '',\n      initiator: false,\n      peer: {},\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n  }\n  hideAuth() {\n    this.props.media.setState({bridge: 'connecting'});\n  } \n  full() {\n    this.props.media.setState({bridge: 'full'});\n  }\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props)\n    this.setState({video: this.props.video, audio: this.props.audio});\n\n    socket.on('create', () =>\n      this.props.media.setState({user: 'host', bridge: 'create'}));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () =>\n      this.props.media.setState({user: 'guest', bridge: 'join'}));\n    socket.on('approve', ({ message, sid }) => {\n      this.props.media.setState({bridge: 'approve'});\n      this.setState({ message, sid });\n    });\n    socket.emit('find');\n    this.props.getUserMedia\n      .then(stream => {\n          this.localStream = stream;\n          this.localStream.getVideoTracks()[0].enabled = this.state.video;\n          this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n        });\n  }\n  handleInput(e) {\n    this.setState({[e.target.dataset.ref]: e.target.value});\n  }\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n  toggleVideo() {\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({video: video});\n    this.props.setVideo(video);\n  }\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({audio: audio});\n    this.props.setAudio(audio);\n  }\n  handleHangup() {\n    this.props.media.hangup();\n  }\n  getDisplay(){\n    getDisplayStream().then(stream => {\n      stream.oninactive = () => {\n        this.state.peer.removeStream(this.state.localStream)  \n        this.getUserMedia().then(() => {\n          this.state.peer.addStream(this.state.localStream)  \n        })\n      }\n      this.setState({ streamUrl: stream, localStream: stream })\n      this.localVideo.srcObject = stream   \n      this.state.peer.addStream(stream)   \n    })\n  }\n  render(){\n    return (\n      <Communication\n        {...this.state}\n        toggleVideo={this.toggleVideo}\n        toggleAudio={this.toggleAudio}\n        send={this.send}\n        handleHangup={this.handleHangup}\n        handleInput={this.handleInput}\n        handleInvitation={this.handleInvitation} />\n    );\n  }\n}\nconst mapStateToProps = store => ({video: store.video, audio: store.audio});\nconst mapDispatchToProps = dispatch => (\n  {\n    setVideo: boo => store.dispatch({type: 'SET_VIDEO', video: boo}),\n    setAudio: boo => store.dispatch({type: 'SET_AUDIO', audio: boo})\n  }\n);\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);"]},"metadata":{},"sourceType":"module"}