{"ast":null,"code":"var _jsxFileName = \"/Users/seojin-won/wisdom-x-wisdom/client/src/containers/CommunicationContainer.js\";\nimport React from 'react';\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer';\nimport Communication from '../components/Communication';\nimport store from '../store';\nimport { connect } from 'react-redux';\n\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n    this.screenSharing = this.screenSharing.bind(this);\n  }\n\n  hideAuth() {\n    this.props.media.setState({\n      bridge: 'connecting'\n    });\n  }\n\n  full() {\n    this.props.media.setState({\n      bridge: 'full'\n    });\n  }\n\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props);\n    this.setState({\n      video: this.props.video,\n      audio: this.props.audio\n    });\n    socket.on('create', () => this.props.media.setState({\n      user: 'host',\n      bridge: 'create'\n    }));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () => this.props.media.setState({\n      user: 'guest',\n      bridge: 'join'\n    }));\n    socket.on('approve', ({\n      message,\n      sid\n    }) => {\n      this.props.media.setState({\n        bridge: 'approve'\n      });\n      this.setState({\n        message,\n        sid\n      });\n    });\n    socket.emit('find');\n    this.props.getUserMedia.then(stream => {\n      this.localStream = stream;\n      this.localStream.getVideoTracks()[0].enabled = this.state.video;\n      this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n    });\n  }\n\n  handleInput(e) {\n    this.setState({\n      [e.target.dataset.ref]: e.target.value\n    });\n  }\n\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n\n  toggleVideo() {\n    console.log(123123);\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({\n      video: video\n    });\n    this.props.setVideo(video);\n  }\n\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({\n      audio: audio\n    });\n    this.props.setAudio(audio);\n  }\n\n  handleHangup() {\n    this.props.media.hangup();\n  }\n\n  screenSharing() {\n    this.props.mdeia.getDisplay();\n  }\n\n  render() {\n    return React.createElement(Communication, Object.assign({}, this.state, {\n      toggleVideo: this.toggleVideo,\n      toggleAudio: this.toggleAudio,\n      send: this.send,\n      handleHangup: this.handleHangup,\n      handleInput: this.handleInput,\n      handleInvitation: this.handleInvitation,\n      screenSharing: this.screenSharing,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = store => ({\n  video: store.video,\n  audio: store.audio\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setVideo: boo => store.dispatch({\n    type: 'SET_VIDEO',\n    video: boo\n  }),\n  setAudio: boo => store.dispatch({\n    type: 'SET_AUDIO',\n    audio: boo\n  })\n});\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);","map":{"version":3,"sources":["/Users/seojin-won/wisdom-x-wisdom/client/src/containers/CommunicationContainer.js"],"names":["React","PropTypes","MediaContainer","Communication","store","connect","CommunicationContainer","Component","constructor","props","state","sid","message","audio","video","handleInvitation","bind","handleHangup","handleInput","toggleVideo","toggleAudio","send","screenSharing","hideAuth","media","setState","bridge","full","componentDidMount","socket","console","log","on","user","role","init","emit","getUserMedia","then","stream","localStream","getVideoTracks","enabled","getAudioTracks","e","target","dataset","ref","value","preventDefault","setVideo","setAudio","hangup","mdeia","getDisplay","render","mapStateToProps","mapDispatchToProps","dispatch","boo","type","propTypes","object","isRequired","bool","func","instanceOf"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer'\nimport Communication from '../components/Communication'\nimport store from '../store'\nimport { connect } from 'react-redux'\n\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n    this.screenSharing = this.screenSharing.bind(this);\n  }\n  hideAuth() {\n    this.props.media.setState({bridge: 'connecting'});\n  } \n  full() {\n    this.props.media.setState({bridge: 'full'});\n  }\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props)\n    this.setState({video: this.props.video, audio: this.props.audio});\n\n    socket.on('create', () =>\n      this.props.media.setState({user: 'host', bridge: 'create'}));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () =>\n      this.props.media.setState({user: 'guest', bridge: 'join'}));\n    socket.on('approve', ({ message, sid }) => {\n      this.props.media.setState({bridge: 'approve'});\n      this.setState({ message, sid });\n    });\n    socket.emit('find');\n    this.props.getUserMedia\n      .then(stream => {\n          this.localStream = stream;\n          this.localStream.getVideoTracks()[0].enabled = this.state.video;\n          this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n        });\n  }\n  handleInput(e) {\n    this.setState({[e.target.dataset.ref]: e.target.value});\n  }\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n  toggleVideo() {\n    console.log(123123)\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({video: video});\n    this.props.setVideo(video);\n  }\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({audio: audio});\n    this.props.setAudio(audio);\n  }\n  handleHangup() {\n    this.props.media.hangup();\n  }\n  screenSharing() {\n    this.props.mdeia.getDisplay();\n  }\n  render(){\n    return (\n      <Communication\n        {...this.state}\n        toggleVideo={this.toggleVideo}\n        toggleAudio={this.toggleAudio}\n        send={this.send}\n        handleHangup={this.handleHangup}\n        handleInput={this.handleInput}\n        handleInvitation={this.handleInvitation}\n        screenSharing={this.screenSharing} />\n    );\n  }\n}\nconst mapStateToProps = store => ({video: store.video, audio: store.audio});\nconst mapDispatchToProps = dispatch => (\n  {\n    setVideo: boo => store.dispatch({type: 'SET_VIDEO', video: boo}),\n    setAudio: boo => store.dispatch({type: 'SET_AUDIO', audio: boo})\n  }\n);\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);"]},"metadata":{},"sourceType":"module"}