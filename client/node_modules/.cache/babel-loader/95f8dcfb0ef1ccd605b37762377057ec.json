{"ast":null,"code":"import _defineProperty from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/seojin-won/webrtc-video-room-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import MediaContainer from'./MediaContainer';import Communication from'../components/Communication';import store from'../store';import{connect}from'react-redux';var CommunicationContainer=/*#__PURE__*/function(_React$Component){_inherits(CommunicationContainer,_React$Component);function CommunicationContainer(props){var _this;_classCallCheck(this,CommunicationContainer);_this=_possibleConstructorReturn(this,_getPrototypeOf(CommunicationContainer).call(this,props));_this.state={sid:'',message:'',audio:true,video:true};_this.handleInvitation=_this.handleInvitation.bind(_assertThisInitialized(_this));_this.handleHangup=_this.handleHangup.bind(_assertThisInitialized(_this));_this.handleInput=_this.handleInput.bind(_assertThisInitialized(_this));_this.toggleVideo=_this.toggleVideo.bind(_assertThisInitialized(_this));_this.toggleAudio=_this.toggleAudio.bind(_assertThisInitialized(_this));_this.send=_this.send.bind(_assertThisInitialized(_this));return _this;}_createClass(CommunicationContainer,[{key:\"hideAuth\",value:function hideAuth(){this.props.media.setState({bridge:'connecting'});}},{key:\"full\",value:function full(){this.props.media.setState({bridge:'full'});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var socket=this.props.socket;console.log('props',this.props);this.setState({video:this.props.video,audio:this.props.audio});socket.on('create',function(){return _this2.props.media.setState({user:'host',bridge:'create'});});socket.on('full',this.full);socket.on('bridge',function(role){return _this2.props.media.init();});socket.on('join',function(){return _this2.props.media.setState({user:'guest',bridge:'join'});});socket.on('approve',function(_ref){var message=_ref.message,sid=_ref.sid;_this2.props.media.setState({bridge:'approve'});_this2.setState({message:message,sid:sid});});socket.emit('find');this.props.getUserMedia.then(function(stream){_this2.localStream=stream;_this2.localStream.getVideoTracks()[0].enabled=_this2.state.video;_this2.localStream.getAudioTracks()[0].enabled=_this2.state.audio;});}},{key:\"handleInput\",value:function handleInput(e){this.setState(_defineProperty({},e.target.dataset.ref,e.target.value));}},{key:\"send\",value:function send(e){e.preventDefault();this.props.socket.emit('auth',this.state);this.hideAuth();}},{key:\"handleInvitation\",value:function handleInvitation(e){e.preventDefault();this.props.socket.emit([e.target.dataset.ref],this.state.sid);this.hideAuth();}},{key:\"toggleVideo\",value:function toggleVideo(){var video=this.localStream.getVideoTracks()[0].enabled=!this.state.video;this.setState({video:video});this.props.setVideo(video);}},{key:\"toggleAudio\",value:function toggleAudio(){var audio=this.localStream.getAudioTracks()[0].enabled=!this.state.audio;this.setState({audio:audio});this.props.setAudio(audio);}},{key:\"handleHangup\",value:function handleHangup(){this.props.media.hangup();}},{key:\"render\",value:function render(){return React.createElement(Communication,Object.assign({},this.state,{toggleVideo:this.toggleVideo,toggleAudio:this.toggleAudio,send:this.send,handleHangup:this.handleHangup,handleInput:this.handleInput,handleInvitation:this.handleInvitation}));}}]);return CommunicationContainer;}(React.Component);var mapStateToProps=function mapStateToProps(store){return{video:store.video,audio:store.audio};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{setVideo:function setVideo(boo){return store.dispatch({type:'SET_VIDEO',video:boo});},setAudio:function setAudio(boo){return store.dispatch({type:'SET_AUDIO',audio:boo});}};};export default connect(mapStateToProps,mapDispatchToProps)(CommunicationContainer);","map":{"version":3,"sources":["/Users/seojin-won/webrtc-video-room-master/src/containers/CommunicationContainer.js"],"names":["React","MediaContainer","Communication","store","connect","CommunicationContainer","props","state","sid","message","audio","video","handleInvitation","bind","handleHangup","handleInput","toggleVideo","toggleAudio","send","media","setState","bridge","socket","console","log","on","user","full","role","init","emit","getUserMedia","then","stream","localStream","getVideoTracks","enabled","getAudioTracks","e","target","dataset","ref","value","preventDefault","hideAuth","setVideo","setAudio","hangup","Component","mapStateToProps","mapDispatchToProps","dispatch","boo","type"],"mappings":"uoCAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CAEA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,aAAP,KAA0B,6BAA1B,CACA,MAAOC,CAAAA,KAAP,KAAkB,UAAlB,CACA,OAASC,OAAT,KAAwB,aAAxB,C,GACMC,CAAAA,sB,4FACJ,gCAAYC,KAAZ,CAAmB,wDACjB,wFAAMA,KAAN,GACA,MAAKC,KAAL,CAAa,CACXC,GAAG,CAAE,EADM,CAEXC,OAAO,CAAE,EAFE,CAGXC,KAAK,CAAE,IAHI,CAIXC,KAAK,CAAE,IAJI,CAAb,CAMA,MAAKC,gBAAL,CAAwB,MAAKA,gBAAL,CAAsBC,IAAtB,+BAAxB,CACA,MAAKC,YAAL,CAAoB,MAAKA,YAAL,CAAkBD,IAAlB,+BAApB,CACA,MAAKE,WAAL,CAAmB,MAAKA,WAAL,CAAiBF,IAAjB,+BAAnB,CACA,MAAKG,WAAL,CAAmB,MAAKA,WAAL,CAAiBH,IAAjB,+BAAnB,CACA,MAAKI,WAAL,CAAmB,MAAKA,WAAL,CAAiBJ,IAAjB,+BAAnB,CACA,MAAKK,IAAL,CAAY,MAAKA,IAAL,CAAUL,IAAV,+BAAZ,CAbiB,aAclB,C,8EACU,CACT,KAAKP,KAAL,CAAWa,KAAX,CAAiBC,QAAjB,CAA0B,CAACC,MAAM,CAAE,YAAT,CAA1B,EACD,C,mCACM,CACL,KAAKf,KAAL,CAAWa,KAAX,CAAiBC,QAAjB,CAA0B,CAACC,MAAM,CAAE,MAAT,CAA1B,EACD,C,6DACmB,iBAClB,GAAMC,CAAAA,MAAM,CAAG,KAAKhB,KAAL,CAAWgB,MAA1B,CACAC,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAqB,KAAKlB,KAA1B,EACA,KAAKc,QAAL,CAAc,CAACT,KAAK,CAAE,KAAKL,KAAL,CAAWK,KAAnB,CAA0BD,KAAK,CAAE,KAAKJ,KAAL,CAAWI,KAA5C,CAAd,EAEAY,MAAM,CAACG,EAAP,CAAU,QAAV,CAAoB,iBAClB,CAAA,MAAI,CAACnB,KAAL,CAAWa,KAAX,CAAiBC,QAAjB,CAA0B,CAACM,IAAI,CAAE,MAAP,CAAeL,MAAM,CAAE,QAAvB,CAA1B,CADkB,EAApB,EAEAC,MAAM,CAACG,EAAP,CAAU,MAAV,CAAkB,KAAKE,IAAvB,EACAL,MAAM,CAACG,EAAP,CAAU,QAAV,CAAoB,SAAAG,IAAI,QAAI,CAAA,MAAI,CAACtB,KAAL,CAAWa,KAAX,CAAiBU,IAAjB,EAAJ,EAAxB,EACAP,MAAM,CAACG,EAAP,CAAU,MAAV,CAAkB,iBAChB,CAAA,MAAI,CAACnB,KAAL,CAAWa,KAAX,CAAiBC,QAAjB,CAA0B,CAACM,IAAI,CAAE,OAAP,CAAgBL,MAAM,CAAE,MAAxB,CAA1B,CADgB,EAAlB,EAEAC,MAAM,CAACG,EAAP,CAAU,SAAV,CAAqB,cAAsB,IAAnBhB,CAAAA,OAAmB,MAAnBA,OAAmB,CAAVD,GAAU,MAAVA,GAAU,CACzC,MAAI,CAACF,KAAL,CAAWa,KAAX,CAAiBC,QAAjB,CAA0B,CAACC,MAAM,CAAE,SAAT,CAA1B,EACA,MAAI,CAACD,QAAL,CAAc,CAAEX,OAAO,CAAPA,OAAF,CAAWD,GAAG,CAAHA,GAAX,CAAd,EACD,CAHD,EAIAc,MAAM,CAACQ,IAAP,CAAY,MAAZ,EACA,KAAKxB,KAAL,CAAWyB,YAAX,CACGC,IADH,CACQ,SAAAC,MAAM,CAAI,CACZ,MAAI,CAACC,WAAL,CAAmBD,MAAnB,CACA,MAAI,CAACC,WAAL,CAAiBC,cAAjB,GAAkC,CAAlC,EAAqCC,OAArC,CAA+C,MAAI,CAAC7B,KAAL,CAAWI,KAA1D,CACA,MAAI,CAACuB,WAAL,CAAiBG,cAAjB,GAAkC,CAAlC,EAAqCD,OAArC,CAA+C,MAAI,CAAC7B,KAAL,CAAWG,KAA1D,CACD,CALL,EAMD,C,gDACW4B,C,CAAG,CACb,KAAKlB,QAAL,oBAAgBkB,CAAC,CAACC,MAAF,CAASC,OAAT,CAAiBC,GAAjC,CAAuCH,CAAC,CAACC,MAAF,CAASG,KAAhD,GACD,C,kCACIJ,C,CAAG,CACNA,CAAC,CAACK,cAAF,GACA,KAAKrC,KAAL,CAAWgB,MAAX,CAAkBQ,IAAlB,CAAuB,MAAvB,CAA+B,KAAKvB,KAApC,EACA,KAAKqC,QAAL,GACD,C,0DACgBN,C,CAAG,CAClBA,CAAC,CAACK,cAAF,GACA,KAAKrC,KAAL,CAAWgB,MAAX,CAAkBQ,IAAlB,CAAuB,CAACQ,CAAC,CAACC,MAAF,CAASC,OAAT,CAAiBC,GAAlB,CAAvB,CAA+C,KAAKlC,KAAL,CAAWC,GAA1D,EACA,KAAKoC,QAAL,GACD,C,iDACa,CACZ,GAAMjC,CAAAA,KAAK,CAAG,KAAKuB,WAAL,CAAiBC,cAAjB,GAAkC,CAAlC,EAAqCC,OAArC,CAA+C,CAAC,KAAK7B,KAAL,CAAWI,KAAzE,CACA,KAAKS,QAAL,CAAc,CAACT,KAAK,CAAEA,KAAR,CAAd,EACA,KAAKL,KAAL,CAAWuC,QAAX,CAAoBlC,KAApB,EACD,C,iDACa,CACZ,GAAMD,CAAAA,KAAK,CAAG,KAAKwB,WAAL,CAAiBG,cAAjB,GAAkC,CAAlC,EAAqCD,OAArC,CAA+C,CAAC,KAAK7B,KAAL,CAAWG,KAAzE,CACA,KAAKU,QAAL,CAAc,CAACV,KAAK,CAAEA,KAAR,CAAd,EACA,KAAKJ,KAAL,CAAWwC,QAAX,CAAoBpC,KAApB,EACD,C,mDACc,CACb,KAAKJ,KAAL,CAAWa,KAAX,CAAiB4B,MAAjB,GACD,C,uCACO,CACN,MACE,qBAAC,aAAD,kBACM,KAAKxC,KADX,EAEE,WAAW,CAAE,KAAKS,WAFpB,CAGE,WAAW,CAAE,KAAKC,WAHpB,CAIE,IAAI,CAAE,KAAKC,IAJb,CAKE,YAAY,CAAE,KAAKJ,YALrB,CAME,WAAW,CAAE,KAAKC,WANpB,CAOE,gBAAgB,CAAE,KAAKH,gBAPzB,GADF,CAUD,C,oCAlFkCZ,KAAK,CAACgD,S,EAoF3C,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAA9C,KAAK,QAAK,CAACQ,KAAK,CAAER,KAAK,CAACQ,KAAd,CAAqBD,KAAK,CAAEP,KAAK,CAACO,KAAlC,CAAL,EAA7B,CACA,GAAMwC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAAAC,QAAQ,QACjC,CACEN,QAAQ,CAAE,kBAAAO,GAAG,QAAIjD,CAAAA,KAAK,CAACgD,QAAN,CAAe,CAACE,IAAI,CAAE,WAAP,CAAoB1C,KAAK,CAAEyC,GAA3B,CAAf,CAAJ,EADf,CAEEN,QAAQ,CAAE,kBAAAM,GAAG,QAAIjD,CAAAA,KAAK,CAACgD,QAAN,CAAe,CAACE,IAAI,CAAE,WAAP,CAAoB3C,KAAK,CAAE0C,GAA3B,CAAf,CAAJ,EAFf,CADiC,EAAnC,CAgBA,cAAehD,CAAAA,OAAO,CAAC6C,eAAD,CAAkBC,kBAAlB,CAAP,CAA6C7C,sBAA7C,CAAf","sourcesContent":["import React from 'react'\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer'\nimport Communication from '../components/Communication'\nimport store from '../store'\nimport { connect } from 'react-redux'\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n  }\n  hideAuth() {\n    this.props.media.setState({bridge: 'connecting'});\n  } \n  full() {\n    this.props.media.setState({bridge: 'full'});\n  }\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props)\n    this.setState({video: this.props.video, audio: this.props.audio});\n\n    socket.on('create', () =>\n      this.props.media.setState({user: 'host', bridge: 'create'}));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () =>\n      this.props.media.setState({user: 'guest', bridge: 'join'}));\n    socket.on('approve', ({ message, sid }) => {\n      this.props.media.setState({bridge: 'approve'});\n      this.setState({ message, sid });\n    });\n    socket.emit('find');\n    this.props.getUserMedia\n      .then(stream => {\n          this.localStream = stream;\n          this.localStream.getVideoTracks()[0].enabled = this.state.video;\n          this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n        });\n  }\n  handleInput(e) {\n    this.setState({[e.target.dataset.ref]: e.target.value});\n  }\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n  toggleVideo() {\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({video: video});\n    this.props.setVideo(video);\n  }\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({audio: audio});\n    this.props.setAudio(audio);\n  }\n  handleHangup() {\n    this.props.media.hangup();\n  }\n  render(){\n    return (\n      <Communication\n        {...this.state}\n        toggleVideo={this.toggleVideo}\n        toggleAudio={this.toggleAudio}\n        send={this.send}\n        handleHangup={this.handleHangup}\n        handleInput={this.handleInput}\n        handleInvitation={this.handleInvitation} />\n    );\n  }\n}\nconst mapStateToProps = store => ({video: store.video, audio: store.audio});\nconst mapDispatchToProps = dispatch => (\n  {\n    setVideo: boo => store.dispatch({type: 'SET_VIDEO', video: boo}),\n    setAudio: boo => store.dispatch({type: 'SET_AUDIO', audio: boo})\n  }\n);\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);"]},"metadata":{},"sourceType":"module"}