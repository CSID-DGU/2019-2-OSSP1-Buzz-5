{"ast":null,"code":"var _jsxFileName = \"/Users/seojin-won/wisdom-x-wisdom/client/src/containers/CommunicationContainer.js\";\nimport React from 'react';\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer';\nimport Communication from '../components/Communication';\nimport store from '../store';\nimport { connect } from 'react-redux';\n\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      peer: {},\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n    this.getDisplay = this.getDisplay.bind(this);\n  }\n\n  hideAuth() {\n    this.props.media.setState({\n      bridge: 'connecting'\n    });\n  }\n\n  full() {\n    this.props.media.setState({\n      bridge: 'full'\n    });\n  }\n\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props);\n    this.setState({\n      video: this.props.video,\n      audio: this.props.audio\n    });\n    socket.on('create', () => this.props.media.setState({\n      user: 'host',\n      bridge: 'create'\n    }));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () => this.props.media.setState({\n      user: 'guest',\n      bridge: 'join'\n    }));\n    socket.on('approve', ({\n      message,\n      sid\n    }) => {\n      this.props.media.setState({\n        bridge: 'approve'\n      });\n      this.setState({\n        message,\n        sid\n      });\n    });\n    socket.emit('find');\n    this.props.getUserMedia.then(stream => {\n      this.localStream = stream;\n      this.localStream.getVideoTracks()[0].enabled = this.state.video;\n      this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n    });\n  }\n\n  handleInput(e) {\n    this.setState({\n      [e.target.dataset.ref]: e.target.value\n    });\n  }\n\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n\n  toggleVideo() {\n    console.log(123123);\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({\n      video: video\n    });\n    this.props.setVideo(video);\n  }\n\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({\n      audio: audio\n    });\n    this.props.setAudio(audio);\n  }\n\n  handleHangup() {\n    this.props.media.hangup();\n  }\n\n  render() {\n    return React.createElement(Communication, Object.assign({}, this.state, {\n      toggleVideo: this.toggleVideo,\n      toggleAudio: this.toggleAudio,\n      send: this.send,\n      handleHangup: this.handleHangup,\n      handleInput: this.handleInput,\n      handleInvitation: this.handleInvitation,\n      getDisplay: this.getDisplay,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = store => ({\n  video: store.video,\n  audio: store.audio\n});\n\nconst mapDispatchToProps = dispatch => ({\n  setVideo: boo => store.dispatch({\n    type: 'SET_VIDEO',\n    video: boo\n  }),\n  setAudio: boo => store.dispatch({\n    type: 'SET_AUDIO',\n    audio: boo\n  })\n});\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);","map":{"version":3,"sources":["/Users/seojin-won/wisdom-x-wisdom/client/src/containers/CommunicationContainer.js"],"names":["React","PropTypes","MediaContainer","Communication","store","connect","CommunicationContainer","Component","constructor","props","state","peer","sid","message","audio","video","handleInvitation","bind","handleHangup","handleInput","toggleVideo","toggleAudio","send","getDisplay","hideAuth","media","setState","bridge","full","componentDidMount","socket","console","log","on","user","role","init","emit","getUserMedia","then","stream","localStream","getVideoTracks","enabled","getAudioTracks","e","target","dataset","ref","value","preventDefault","setVideo","setAudio","hangup","render","mapStateToProps","mapDispatchToProps","dispatch","boo","type","propTypes","object","isRequired","bool","func","instanceOf"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { PropTypes } from 'prop-types';\nimport MediaContainer from './MediaContainer'\nimport Communication from '../components/Communication'\nimport store from '../store'\nimport { connect } from 'react-redux'\n\nclass CommunicationContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      peer: {},\n      sid: '',\n      message: '',\n      audio: true,\n      video: true\n    };\n    this.handleInvitation = this.handleInvitation.bind(this);\n    this.handleHangup = this.handleHangup.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n    this.toggleVideo = this.toggleVideo.bind(this);\n    this.toggleAudio = this.toggleAudio.bind(this);\n    this.send = this.send.bind(this);\n    this.getDisplay = this.getDisplay.bind(this);\n  }\n  hideAuth() {\n    this.props.media.setState({bridge: 'connecting'});\n  } \n  full() {\n    this.props.media.setState({bridge: 'full'});\n  }\n  componentDidMount() {\n    const socket = this.props.socket;\n    console.log('props', this.props)\n    this.setState({video: this.props.video, audio: this.props.audio});\n\n    socket.on('create', () =>\n      this.props.media.setState({user: 'host', bridge: 'create'}));\n    socket.on('full', this.full);\n    socket.on('bridge', role => this.props.media.init());\n    socket.on('join', () =>\n      this.props.media.setState({user: 'guest', bridge: 'join'}));\n    socket.on('approve', ({ message, sid }) => {\n      this.props.media.setState({bridge: 'approve'});\n      this.setState({ message, sid });\n    });\n    socket.emit('find');\n    this.props.getUserMedia\n      .then(stream => {\n          this.localStream = stream;\n          this.localStream.getVideoTracks()[0].enabled = this.state.video;\n          this.localStream.getAudioTracks()[0].enabled = this.state.audio;\n        });\n  }\n  handleInput(e) {\n    this.setState({[e.target.dataset.ref]: e.target.value});\n  }\n  send(e) {\n    e.preventDefault();\n    this.props.socket.emit('auth', this.state);\n    this.hideAuth();\n  }\n  handleInvitation(e) {\n    e.preventDefault();\n    this.props.socket.emit([e.target.dataset.ref], this.state.sid);\n    this.hideAuth();\n  }\n  toggleVideo() {\n    console.log(123123)\n    const video = this.localStream.getVideoTracks()[0].enabled = !this.state.video;\n    this.setState({video: video});\n    this.props.setVideo(video);\n  }\n  toggleAudio() {\n    const audio = this.localStream.getAudioTracks()[0].enabled = !this.state.audio;\n    this.setState({audio: audio});\n    this.props.setAudio(audio);\n  }\n  handleHangup() {\n    this.props.media.hangup();\n  }\n  render(){\n    return (\n      <Communication\n        {...this.state}\n        toggleVideo={this.toggleVideo}\n        toggleAudio={this.toggleAudio}\n        send={this.send}\n        handleHangup={this.handleHangup}\n        handleInput={this.handleInput}\n        handleInvitation={this.handleInvitation}\n        getDisplay={this.getDisplay} />\n    );\n  }\n}\nconst mapStateToProps = store => ({video: store.video, audio: store.audio});\nconst mapDispatchToProps = dispatch => (\n  {\n    setVideo: boo => store.dispatch({type: 'SET_VIDEO', video: boo}),\n    setAudio: boo => store.dispatch({type: 'SET_AUDIO', audio: boo})\n  }\n);\n\nCommunicationContainer.propTypes = {\n  socket: PropTypes.object.isRequired,\n  getUserMedia: PropTypes.object.isRequired,\n  audio: PropTypes.bool.isRequired,\n  video: PropTypes.bool.isRequired,\n  setVideo: PropTypes.func.isRequired,\n  setAudio: PropTypes.func.isRequired,\n  media: PropTypes.instanceOf(MediaContainer)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CommunicationContainer);"]},"metadata":{},"sourceType":"module"}