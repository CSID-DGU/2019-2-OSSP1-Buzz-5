(this["webpackJsonpbuzz-webrtc-online-course"]=this["webpackJsonpbuzz-webrtc-online-course"]||[]).push([[0],{124:function(e,t){},127:function(e,t,n){},148:function(e,t,n){},149:function(e,t,n){},152:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(19),s=n.n(i),c=n(13),r=n(14),l=n(16),u=n(15),d=n(17),m=n(161),h=n(163),p=n(162),v=n(24),g=n(28),f=n(35),b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return"ADD_ROOM"===t.type?Object(f.a)(new Set([].concat(Object(f.a)(e),[t.room]))):e},E=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return"SET_AUDIO"===t.type?t.audio:e},w=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return"SET_VIDEO"===t.type?t.video:e},k=Object(g.b)({rooms:b,video:w,audio:E}),O=localStorage.getItem("reduxState")?JSON.parse(localStorage.getItem("reduxState")):{rooms:[],video:!0,audio:!0},S=Object(g.c)(k,O);S.subscribe((function(){return localStorage.setItem("reduxState",JSON.stringify(S.getState()))}));var y=S,j=n(9),D=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={bridge:"",user:""},n.onRemoteHangup=n.onRemoteHangup.bind(Object(j.a)(n)),n.onMessage=n.onMessage.bind(Object(j.a)(n)),n.sendData=n.sendData.bind(Object(j.a)(n)),n.setupDataHandlers=n.setupDataHandlers.bind(Object(j.a)(n)),n.setDescription=n.setDescription.bind(Object(j.a)(n)),n.sendDescription=n.sendDescription.bind(Object(j.a)(n)),n.hangup=n.hangup.bind(Object(j.a)(n)),n.init=n.init.bind(Object(j.a)(n)),n.setDescription=n.setDescription.bind(Object(j.a)(n)),n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentWillMount",value:function(){window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection,this.props.media(this)}},{key:"componentDidMount",value:function(){var e=this;this.props.getUserMedia.then((function(t){return e.localVideo.srcObject=e.localStream=t})),this.props.socket.on("message",this.onMessage),this.props.socket.on("hangup",this.onRemoteHangup)}},{key:"componentWillUnmount",value:function(){this.props.media(null),void 0!==this.localStream&&this.localStream.getVideoTracks()[0].stop(),this.props.socket.emit("leave")}},{key:"onRemoteHangup",value:function(){this.setState({user:"host",bridge:"host-hangup"})}},{key:"onMessage",value:function(e){"offer"===e.type?(this.pc.setRemoteDescription(new RTCSessionDescription(e)),this.pc.createAnswer().then(this.setDescription).then(this.sendDescription).catch(this.handleError)):"answer"===e.type?this.pc.setRemoteDescription(new RTCSessionDescription(e)):"candidate"===e.type&&this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:e.mlineindex,candidate:e.candidate}))}},{key:"sendData",value:function(e){this.dc.send(JSON.stringify(e))}},{key:"setupDataHandlers",value:function(){var e=this;this.dc.onmessage=function(e){var t=JSON.parse(e.data);console.log("received message over data channel:"+t)},this.dc.onclose=function(){e.remoteStream.getVideoTracks()[0].stop(),console.log("The Data Channel is Closed")}}},{key:"setDescription",value:function(e){this.pc.setLocalDescription(e)}},{key:"sendDescription",value:function(){this.props.socket.send(this.pc.localDescription)}},{key:"hangup",value:function(){this.setState({user:"guest",bridge:"guest-hangup"}),this.pc.close(),this.props.socket.emit("leave")}},{key:"handleError",value:function(e){console.log(e)}},{key:"init",value:function(){var e=this;this.pc=new RTCPeerConnection({iceServers:[{url:"stun:stun.l.google.com:19302"}]}),this.pc.onicecandidate=function(t){console.log(t,"onicecandidate"),t.candidate&&e.props.socket.send({type:"candidate",mlineindex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate})},this.pc.onaddstream=function(t){console.log("onaddstream",t),e.remoteStream=t.stream,e.remoteVideo.srcObject=e.remoteStream=t.stream,e.setState({bridge:"established"})},this.pc.ondatachannel=function(t){e.dc=t.channel,e.setupDataHandlers(),e.sendData({peerMediaStream:{video:e.localStream.getVideoTracks()[0].enabled}})},this.localStream.getTracks().forEach((function(t){return e.pc.addTrack(t,e.localStream)})),"host"===this.state.user&&this.props.getUserMedia.then((function(){e.dc=e.pc.createDataChannel("chat"),e.setupDataHandlers(),console.log("attachMediaIfReady"),e.pc.createOffer().then(e.setDescription).then(e.sendDescription).catch(e.handleError)}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"media-bridge ".concat(this.state.bridge)},o.a.createElement("video",{className:"remote-video",ref:function(t){return e.remoteVideo=t},autoPlay:!0}),o.a.createElement("video",{className:"local-video",ref:function(t){return e.localVideo=t},autoPlay:!0,muted:!0}))}}]),t}(a.Component),C=n(78),N=n(157),M=document.documentElement;document.fullscreenEnabled=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,M.requestFullscreen=M.requestFullscreen||M.webkitRequestFullscreen||M.mozRequestFullScreen||M.msRequestFullScreen;var V=function(){document.fullscreenEnabled&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?document.exitFullscreen():M.requestFullscreen())},x=function(e){return o.a.createElement("div",{className:"auth"},o.a.createElement("div",{className:"media-controls"},o.a.createElement(N.a,{className:"call-exit-button",to:"/"},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",className:"svg"},o.a.createElement("path",{d:"M30 16.5h-18.26l8.38-8.38-2.12-2.12-12 12 12 12 2.12-2.12-8.38-8.38h18.26v-3z",fill:"white"}))),o.a.createElement("button",{onClick:e.toggleAudio,className:"audio-button-"+e.audio},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{className:"on",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),o.a.createElement("path",{className:"off",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"}))),o.a.createElement("button",{onClick:e.toggleVideo,className:"video-button-"+e.video},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{className:"on",d:"M40 8H15.64l8 8H28v4.36l1.13 1.13L36 16v12.36l7.97 7.97L44 36V12c0-2.21-1.79-4-4-4zM4.55 2L2 4.55l4.01 4.01C4.81 9.24 4 10.52 4 12v24c0 2.21 1.79 4 4 4h29.45l4 4L44 41.46 4.55 2zM12 16h1.45L28 30.55V32H12V16z",fill:"white"}),o.a.createElement("path",{className:"off",d:"M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm-4 24l-8-6.4V32H12V16h16v6.4l8-6.4v16z",fill:"white"}))),o.a.createElement("button",{onClick:V,className:"fullscreen-button"},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{className:"on",d:"M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z",fill:"white"}),o.a.createElement("path",{className:"off",d:"M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z",fill:"white"}))),o.a.createElement("button",{onClick:e.handleHangup,className:"hangup-button"},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"svg"},o.a.createElement("path",{d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})))),o.a.createElement("div",{className:"request-access"},o.a.createElement("p",null,o.a.createElement("span",{className:"you-left"},"You hung up.\xa0"),"Send an invitation to join the room."),o.a.createElement("form",{onSubmit:e.send},o.a.createElement("input",{type:"text",autoFocus:!0,onChange:e.handleInput,"data-ref":"message",maxLength:"30",required:!0,placeholder:"Hi, I'm John Doe."}),o.a.createElement("button",{className:"primary-button"},"Send"))),o.a.createElement("div",{className:"grant-access"},o.a.createElement("p",null,"A peer has sent you a message to join the room:"),o.a.createElement("div",null,e.message),o.a.createElement("button",{onClick:e.handleInvitation,"data-ref":"reject",className:"primary-button"},"Reject"),o.a.createElement("button",{onClick:e.handleInvitation,"data-ref":"accept",className:"primary-button"},"Accept")),o.a.createElement("div",{className:"room-occupied"},o.a.createElement("p",null,"Please, try another room!"),o.a.createElement(N.a,{className:"primary-button",to:"/"},"OK")),o.a.createElement("div",{className:"waiting"},o.a.createElement("p",null,o.a.createElement("span",null,"Waiting for someone to join this room:\xa0"),o.a.createElement("a",{href:window.location.href},window.location.href),o.a.createElement("br",null),o.a.createElement("span",{className:"remote-left"},"The remote side hung up."))))},I=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={sid:"",message:"",audio:!0,video:!0},n.handleInvitation=n.handleInvitation.bind(Object(j.a)(n)),n.handleHangup=n.handleHangup.bind(Object(j.a)(n)),n.handleInput=n.handleInput.bind(Object(j.a)(n)),n.toggleVideo=n.toggleVideo.bind(Object(j.a)(n)),n.toggleAudio=n.toggleAudio.bind(Object(j.a)(n)),n.send=n.send.bind(Object(j.a)(n)),n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"hideAuth",value:function(){this.props.media.setState({bridge:"connecting"})}},{key:"full",value:function(){this.props.media.setState({bridge:"full"})}},{key:"componentDidMount",value:function(){var e=this,t=this.props.socket;console.log("props",this.props),this.setState({video:this.props.video,audio:this.props.audio}),t.on("create",(function(){return e.props.media.setState({user:"host",bridge:"create"})})),t.on("full",this.full),t.on("bridge",(function(t){return e.props.media.init()})),t.on("join",(function(){return e.props.media.setState({user:"guest",bridge:"join"})})),t.on("approve",(function(t){var n=t.message,a=t.sid;e.props.media.setState({bridge:"approve"}),e.setState({message:n,sid:a})})),t.emit("find"),this.props.getUserMedia.then((function(t){e.localStream=t,e.localStream.getVideoTracks()[0].enabled=e.state.video,e.localStream.getAudioTracks()[0].enabled=e.state.audio}))}},{key:"handleInput",value:function(e){this.setState(Object(C.a)({},e.target.dataset.ref,e.target.value))}},{key:"send",value:function(e){e.preventDefault(),this.props.socket.emit("auth",this.state),this.hideAuth()}},{key:"handleInvitation",value:function(e){e.preventDefault(),this.props.socket.emit([e.target.dataset.ref],this.state.sid),this.hideAuth()}},{key:"toggleVideo",value:function(){var e=this.localStream.getVideoTracks()[0].enabled=!this.state.video;this.setState({video:e}),this.props.setVideo(e)}},{key:"toggleAudio",value:function(){var e=this.localStream.getAudioTracks()[0].enabled=!this.state.audio;this.setState({audio:e}),this.props.setAudio(e)}},{key:"handleHangup",value:function(){this.props.media.hangup()}},{key:"render",value:function(){return o.a.createElement(x,Object.assign({},this.state,{toggleVideo:this.toggleVideo,toggleAudio:this.toggleAudio,send:this.send,handleHangup:this.handleHangup,handleInput:this.handleInput,handleInvitation:this.handleInvitation}))}}]),t}(o.a.Component),z=Object(v.b)((function(e){return{video:e.video,audio:e.audio}}),(function(e){return{setVideo:function(e){return y.dispatch({type:"SET_VIDEO",video:e})},setAudio:function(e){return y.dispatch({type:"SET_AUDIO",audio:e})}}}))(I),H=n(79),R=n.n(H),T=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).getUserMedia=navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).catch((function(e){return alert("getUserMedia() error: "+e.name)})),n.socket=R.a.connect(),n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.props.addRoom()}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(D,{media:function(t){return e.media=t},socket:this.socket,getUserMedia:this.getUserMedia}),o.a.createElement(z,{socket:this.socket,media:this.media,getUserMedia:this.getUserMedia}))}}]),t}(a.Component),A=Object(v.b)((function(e){return{rooms:new Set(Object(f.a)(e.rooms))}}),(function(e,t){return{addRoom:function(){return y.dispatch({type:"ADD_ROOM",room:t.match.params.room})}}}))(T),F=function(){return o.a.createElement("h1",null,"404.. This page is not found!")},L=Object(v.b)((function(e){return{rooms:e.rooms}}))((function(e){return o.a.createElement("div",{className:"home"},o.a.createElement("div",null,o.a.createElement("h1",{itemProp:"headline"},"WxW Course Page"),o.a.createElement("p",null,"Please enter a room name."),o.a.createElement("input",{type:"text",name:"room",value:e.roomId,onChange:e.handleChange,pattern:"^\\w+$",maxLength:"10",required:!0,autoFocus:!0,title:"Room name should only contain letters or numbers."}),o.a.createElement(N.a,{className:"primary-button",to:"/r/"+e.roomId},"Join")))})),U=n(158),P=n(81),q=n(159),J=n(160),B=n(86),W=(n(127),n(39)),_=n.n(W),$=(a.Component,n(148),a.Component,n(149),n(150),function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(v.a,{store:y,basename:""},o.a.createElement(m.a,null,o.a.createElement(h.a,null,o.a.createElement(p.a,{path:"/",component:L}),o.a.createElement(p.a,{path:"/r/:room",component:A}),o.a.createElement(p.a,{path:"*",component:F})))))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement($,null),document.getElementById("app")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},39:function(e,t,n){e.exports=n.p+"static/media/logo_wxw.554a3f5d.png"},88:function(e,t,n){e.exports=n(152)}},[[88,1,2]]]);
//# sourceMappingURL=main.7f98a386.chunk.js.map